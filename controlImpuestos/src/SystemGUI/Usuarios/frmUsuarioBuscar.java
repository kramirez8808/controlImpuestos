/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package SystemGUI.Usuarios;

import SystemGUI.Usuarios.*;
import javax.swing.JOptionPane;

import controlimpuestos.cUsuarios;
import controlimpuestos.SystemCRUD.crudUsuarios;

/**
 *
 * @author fanta
 */
public class frmUsuarioBuscar extends javax.swing.JPanel {

    //Variables requeridas para obtener los datos del formulario
    private String nombreUsuario, contrasena,idUsuario, idAnterior;

    //Instancia del objeto SystemCRUD.crudUsuarios
    private crudUsuarios crudUsuarios;

    public static cUsuarios usuarioResultado;

    private java.awt.Color lightGray = new java.awt.Color(153,153,153);


    /**
     * Creates new form frmTest
     */
    public frmUsuarioBuscar() {
        initComponents();

        //Instanciar la clase crudUsuarios
        crudUsuarios = new crudUsuarios();

        pnlBuscar.setVisible(true);
        pnlResultado.setVisible(false);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pnlBuscar = new javax.swing.JPanel();
        h1Busqueda = new javax.swing.JLabel();
        jlUsuario = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();
        tfUsuario = new javax.swing.JTextField();
        jlID = new javax.swing.JLabel();
        jSeparator2 = new javax.swing.JSeparator();
        tfID = new javax.swing.JTextField();
        btnBuscar = new javax.swing.JPanel();
        jlBuscar = new javax.swing.JLabel();
        pnlResultado = new javax.swing.JPanel();
        h1Registro = new javax.swing.JLabel();
        btnEliminar = new javax.swing.JPanel();
        jlEliminar = new javax.swing.JLabel();
        btnEditar = new javax.swing.JPanel();
        jlEditar = new javax.swing.JLabel();
        jlUsuarioResultado = new javax.swing.JLabel();
        tfUsuarioResultado = new javax.swing.JTextField();
        jSeparator3 = new javax.swing.JSeparator();
        jlContrasena = new javax.swing.JLabel();
        pfContrasenaResultado = new javax.swing.JPasswordField();
        jSeparator4 = new javax.swing.JSeparator();

        setBackground(new java.awt.Color(255, 255, 255));
        setLayout(new java.awt.CardLayout());

        pnlBuscar.setBackground(new java.awt.Color(255, 255, 255));
        pnlBuscar.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        h1Busqueda.setBackground(new java.awt.Color(21, 14, 48));
        h1Busqueda.setFont(new java.awt.Font("Roboto", 3, 22)); // NOI18N
        h1Busqueda.setText("Búsqueda de usuarios");
        pnlBuscar.add(h1Busqueda, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 26, 268, 40));

        jlUsuario.setFont(new java.awt.Font("Roboto", 0, 14)); // NOI18N
        jlUsuario.setForeground(new java.awt.Color(21, 14, 48));
        jlUsuario.setText("Por Nombre de Usuario:");
        pnlBuscar.add(jlUsuario, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 106, -1, -1));

        jSeparator1.setBackground(new java.awt.Color(255, 255, 255));
        jSeparator1.setForeground(new java.awt.Color(21, 14, 48));
        pnlBuscar.add(jSeparator1, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 130, 230, 10));

        tfUsuario.setFont(new java.awt.Font("Roboto", 2, 12)); // NOI18N
        tfUsuario.setForeground(new java.awt.Color(153, 153, 153));
        tfUsuario.setText("Ingrese el nombre de usuario");
        tfUsuario.setBorder(null);
        tfUsuario.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                tfUsuarioFocusGained(evt);
            }
        });
        pnlBuscar.add(tfUsuario, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 100, 230, 30));

        jlID.setFont(new java.awt.Font("Roboto", 0, 14)); // NOI18N
        jlID.setForeground(new java.awt.Color(21, 14, 48));
        jlID.setText("Por ID:");
        pnlBuscar.add(jlID, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 200, -1, -1));

        jSeparator2.setBackground(new java.awt.Color(255, 255, 255));
        jSeparator2.setForeground(new java.awt.Color(21, 14, 48));
        pnlBuscar.add(jSeparator2, new org.netbeans.lib.awtextra.AbsoluteConstraints(90, 220, 80, 10));

        tfID.setFont(new java.awt.Font("Roboto", 2, 12)); // NOI18N
        tfID.setForeground(new java.awt.Color(153, 153, 153));
        tfID.setText("Ingrese el ID");
        tfID.setBorder(null);
        tfID.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                tfIDFocusGained(evt);
            }
        });
        pnlBuscar.add(tfID, new org.netbeans.lib.awtextra.AbsoluteConstraints(90, 190, 80, 30));

        btnBuscar.setBackground(new java.awt.Color(21, 14, 48));
        btnBuscar.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));

        jlBuscar.setBackground(new java.awt.Color(21, 14, 48));
        jlBuscar.setFont(new java.awt.Font("Roboto Light", 0, 18)); // NOI18N
        jlBuscar.setForeground(new java.awt.Color(255, 255, 255));
        jlBuscar.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jlBuscar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/SystemGUI/images/searchMini.png"))); // NOI18N
        jlBuscar.setText("Buscar");
        jlBuscar.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jlBuscarMouseClicked(evt);
            }
        });

        javax.swing.GroupLayout btnBuscarLayout = new javax.swing.GroupLayout(btnBuscar);
        btnBuscar.setLayout(btnBuscarLayout);
        btnBuscarLayout.setHorizontalGroup(
            btnBuscarLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jlBuscar, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 100, Short.MAX_VALUE)
        );
        btnBuscarLayout.setVerticalGroup(
            btnBuscarLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jlBuscar, javax.swing.GroupLayout.DEFAULT_SIZE, 40, Short.MAX_VALUE)
        );

        pnlBuscar.add(btnBuscar, new org.netbeans.lib.awtextra.AbsoluteConstraints(510, 494, -1, -1));

        add(pnlBuscar, "card2");

        pnlResultado.setBackground(new java.awt.Color(255, 255, 255));
        pnlResultado.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        h1Registro.setBackground(new java.awt.Color(21, 14, 48));
        h1Registro.setFont(new java.awt.Font("Roboto", 3, 22)); // NOI18N
        h1Registro.setText("Resultado de la búsqueda");
        pnlResultado.add(h1Registro, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 20, 260, 40));

        btnEliminar.setBackground(new java.awt.Color(255, 51, 51));
        btnEliminar.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));

        jlEliminar.setBackground(new java.awt.Color(21, 14, 48));
        jlEliminar.setFont(new java.awt.Font("Roboto Light", 0, 18)); // NOI18N
        jlEliminar.setForeground(new java.awt.Color(255, 255, 255));
        jlEliminar.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jlEliminar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/SystemGUI/images/deleteMini.png"))); // NOI18N
        jlEliminar.setText("Eliminar");
        jlEliminar.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mousePressed(java.awt.event.MouseEvent evt) {
                jlEliminarMousePressed(evt);
            }
        });

        javax.swing.GroupLayout btnEliminarLayout = new javax.swing.GroupLayout(btnEliminar);
        btnEliminar.setLayout(btnEliminarLayout);
        btnEliminarLayout.setHorizontalGroup(
            btnEliminarLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jlEliminar, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 100, Short.MAX_VALUE)
        );
        btnEliminarLayout.setVerticalGroup(
            btnEliminarLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jlEliminar, javax.swing.GroupLayout.DEFAULT_SIZE, 40, Short.MAX_VALUE)
        );

        pnlResultado.add(btnEliminar, new org.netbeans.lib.awtextra.AbsoluteConstraints(510, 500, -1, -1));

        btnEditar.setBackground(new java.awt.Color(21, 14, 48));
        btnEditar.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));

        jlEditar.setBackground(new java.awt.Color(21, 14, 48));
        jlEditar.setFont(new java.awt.Font("Roboto Light", 0, 18)); // NOI18N
        jlEditar.setForeground(new java.awt.Color(255, 255, 255));
        jlEditar.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jlEditar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/SystemGUI/images/editMini.png"))); // NOI18N
        jlEditar.setText("Editar");
        jlEditar.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jlEditarMouseClicked(evt);
            }
        });

        javax.swing.GroupLayout btnEditarLayout = new javax.swing.GroupLayout(btnEditar);
        btnEditar.setLayout(btnEditarLayout);
        btnEditarLayout.setHorizontalGroup(
            btnEditarLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jlEditar, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 100, Short.MAX_VALUE)
        );
        btnEditarLayout.setVerticalGroup(
            btnEditarLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jlEditar, javax.swing.GroupLayout.DEFAULT_SIZE, 40, Short.MAX_VALUE)
        );

        pnlResultado.add(btnEditar, new org.netbeans.lib.awtextra.AbsoluteConstraints(400, 500, -1, -1));

        jlUsuarioResultado.setFont(new java.awt.Font("Roboto", 0, 14)); // NOI18N
        jlUsuarioResultado.setForeground(new java.awt.Color(21, 14, 48));
        jlUsuarioResultado.setText("Usuario:");
        pnlResultado.add(jlUsuarioResultado, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 100, -1, -1));

        tfUsuarioResultado.setFont(new java.awt.Font("Roboto", 2, 12)); // NOI18N
        tfUsuarioResultado.setForeground(new java.awt.Color(153, 153, 153));
        tfUsuarioResultado.setBorder(null);
        pnlResultado.add(tfUsuarioResultado, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 90, 230, 30));

        jSeparator3.setBackground(new java.awt.Color(255, 255, 255));
        jSeparator3.setForeground(new java.awt.Color(21, 14, 48));
        pnlResultado.add(jSeparator3, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 120, 230, 10));

        jlContrasena.setFont(new java.awt.Font("Roboto", 0, 14)); // NOI18N
        jlContrasena.setForeground(new java.awt.Color(21, 14, 48));
        jlContrasena.setText("Contraseña:");
        pnlResultado.add(jlContrasena, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 160, -1, -1));

        pfContrasenaResultado.setForeground(new java.awt.Color(153, 153, 153));
        pfContrasenaResultado.setBorder(null);
        pnlResultado.add(pfContrasenaResultado, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 150, 230, 30));

        jSeparator4.setBackground(new java.awt.Color(255, 255, 255));
        jSeparator4.setForeground(new java.awt.Color(21, 14, 48));
        pnlResultado.add(jSeparator4, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 180, 230, 10));

        add(pnlResultado, "card3");
    }// </editor-fold>//GEN-END:initComponents

    private void jlEditarMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jlEditarMouseClicked
        //Guardar ID anterior para la busqueda en DB
        idAnterior = String.valueOf(crudUsuarios.returnIdAnterior());

        //Obtener los datos del formulario
        nombreUsuario = tfUsuarioResultado.getText();
        contrasena = String.valueOf(pfContrasenaResultado.getPassword());
        
        //Verificar que los campos no esten vacios
        if (!nombreUsuario.equals("") || !contrasena.equals("")) {
            try {
                //Actualizar los datos del objeto usuario previamente encontrado
                usuarioResultado.setUsuario(nombreUsuario);
                usuarioResultado.setContrasena(contrasena);

                //Llamar al metodo de actualizar
                crudUsuarios.actualizarUsuario(usuarioResultado, idAnterior);

                //Mostrar mensaje de exito
                JOptionPane.showMessageDialog(null, "Usuario actualizado con éxito", "Exito", JOptionPane.INFORMATION_MESSAGE);

            } catch (Exception e) {
                JOptionPane.showMessageDialog(null, "Error en el proceso de actualización: " + e.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
            }
        } else {
            JOptionPane.showMessageDialog(null, "Debe llenar todos los campos", "Error", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_jlEditarMouseClicked

    private void jlEliminarMousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jlEliminarMousePressed
        //Obtener el ID del usuario a eliminar
        idAnterior = String.valueOf(crudUsuarios.returnIdAnterior());

        //Confirmar que se desea eliminar el usuario
        int opcion = JOptionPane.showConfirmDialog(null, "¿Está seguro que desea eliminar el usuario?", "Confirmar eliminación", JOptionPane.YES_NO_OPTION, JOptionPane.QUESTION_MESSAGE);

        try {
            //Eliminar el cliente en caso de seleccionar confirmar
            if (opcion == JOptionPane.YES_OPTION) {
                //Se invoca el metodo de eliminarCliente
                crudUsuarios.eliminarUsuario(usuarioResultado);

                //Evitar que se seleccione el campo "Por Nombre:" por defecto al volver al panel de busqueda
                h1Busqueda.requestFocusInWindow();

                //Volver a la pantalla de busqueda
                pnlResultado.setVisible(false);
                pnlBuscar.setVisible(true);


            } else {
                JOptionPane.showMessageDialog(null, "Se ha cancelado el proceso de eliminación", "Eliminación cancelada", JOptionPane.INFORMATION_MESSAGE);
            }
            
        } catch (Exception e) {
            JOptionPane.showMessageDialog(null, "Error en el proceso de eliminación: " + e.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_jlEliminarMousePressed

    private void jlBuscarMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jlBuscarMouseClicked
        //Obtener el texto de los campos
        nombreUsuario = tfUsuario.getText();
        idUsuario = tfID.getText();

        //Buscar y mostrar los datos segun el campo llenado
        if (!nombreUsuario.equals("") && !nombreUsuario.equals("Ingrese el nombre de usuario")) {

            //Llamar al metodo de busqueda y guardar los resultados
            try {
                usuarioResultado = crudUsuarios.buscarUsuarioNombre(nombreUsuario);

                h1Busqueda.requestFocusInWindow();
                tfUsuario.setText("Ingrese el nombre de usuario");
                tfUsuario.setForeground(lightGray);
                tfID.setText("Ingrese el ID");
                tfID.setForeground(lightGray);

                //Verificar que el cliente exista y mostrar los datos en el nuevo panel
                if (usuarioResultado != null) {
                    tfUsuarioResultado.setForeground(btnBuscar.getForeground());
                    pfContrasenaResultado.setForeground(btnBuscar.getForeground());
                    tfUsuarioResultado.setText(usuarioResultado.getUsuario());
                    pfContrasenaResultado.setText(usuarioResultado.getContrasena());

                    //Cambiar de panel
                    pnlBuscar.setVisible(false);
                    pnlResultado.setVisible(true);

                }

            } catch (Exception e) {
                JOptionPane.showMessageDialog(null, "Error en el proceso de busqueda: " + e.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
            }

        } else if (!idUsuario.equals("") && !idUsuario.equals("Ingrese el ID")) {

            //Llamar al metodo de busqueda y guardar los resultados
            try {
                usuarioResultado = crudUsuarios.buscarUsuarioID(idUsuario);

                h1Busqueda.requestFocusInWindow();
                tfUsuario.setText("Ingrese el nombre de usuario");
                tfUsuario.setForeground(lightGray);
                tfID.setText("Ingrese el ID");
                tfID.setForeground(lightGray);

                //Verificar que el cliente exista y mostrar los datos en el nuevo panel
                if (usuarioResultado != null) {
                    tfUsuarioResultado.setForeground(btnBuscar.getForeground());
                    pfContrasenaResultado.setForeground(btnBuscar.getForeground());
                    tfUsuarioResultado.setText(usuarioResultado.getUsuario());
                    pfContrasenaResultado.setText(usuarioResultado.getContrasena());

                    //Cambiar de panel
                    pnlBuscar.setVisible(false);
                    pnlResultado.setVisible(true);
                }

            } catch (Exception e) {
                JOptionPane.showMessageDialog(null, "Error en el proceso de busqueda: " + e.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
            }
        } else {
            JOptionPane.showMessageDialog(null, "Debe llenar al menos un campo para realizar la búsqueda", "Error", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_jlBuscarMouseClicked

    private void tfIDFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_tfIDFocusGained
        // Metodo para eliminar el texto por default y cambiar a un color más oscuro. Tambien evita que el texto se borre cuando el usuario escribe
        if (tfID.getText().equals("Ingrese el ID")) {
            tfID.setText("");
            tfID.setForeground(btnBuscar.getForeground());
        }
    }//GEN-LAST:event_tfIDFocusGained

    private void tfUsuarioFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_tfUsuarioFocusGained
        // Metodo para eliminar el texto por default y cambiar a un color más oscuro. Tambien evita que el texto se borre cuando el usuario escribe
        if (tfUsuario.getText().equals("Ingrese el nombre de usuario")) {
            tfUsuario.setText("");
            tfUsuario.setForeground(btnBuscar.getForeground());
        }
    }//GEN-LAST:event_tfUsuarioFocusGained


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel btnBuscar;
    private javax.swing.JPanel btnEditar;
    private javax.swing.JPanel btnEliminar;
    private javax.swing.JLabel h1Busqueda;
    private javax.swing.JLabel h1Registro;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JSeparator jSeparator2;
    private javax.swing.JSeparator jSeparator3;
    private javax.swing.JSeparator jSeparator4;
    private javax.swing.JLabel jlBuscar;
    private javax.swing.JLabel jlContrasena;
    private javax.swing.JLabel jlEditar;
    private javax.swing.JLabel jlEliminar;
    private javax.swing.JLabel jlID;
    private javax.swing.JLabel jlUsuario;
    private javax.swing.JLabel jlUsuarioResultado;
    private javax.swing.JPasswordField pfContrasenaResultado;
    private javax.swing.JPanel pnlBuscar;
    private javax.swing.JPanel pnlResultado;
    private javax.swing.JTextField tfID;
    private javax.swing.JTextField tfUsuario;
    private javax.swing.JTextField tfUsuarioResultado;
    // End of variables declaration//GEN-END:variables
}
